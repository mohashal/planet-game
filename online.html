<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ù…Ø³ØªÙƒØ´Ù Ø§Ù„ÙØ¶Ø§Ø¡ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
    <style>
        :root {
            --space-dark: #00021a;
            --neon-blue: #00d4ff;
            --success: #00ffcc;
            --gold: #ffd700;
            --error: #ff3366;
        }

        * { user-select: none; -webkit-user-drag: none; box-sizing: border-box; }

        body {
            margin: 0; min-height: 100vh; background: var(--space-dark);
            color: white; font-family: 'Noto Kufi Arabic', sans-serif !important;
            font-optical-sizing:auto;font-weight:200;font-style:normal;font-size:1rem;
            display: flex; flex-direction: column; align-items: center;
            overflow: hidden; touch-action: none;
        }

.star-field {
    position: fixed;
    top: 0;
    left: 0;
    right:0;
    bottom:0;
    inset: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at center, #001233 0%, #00021a 100%);
    perspective: 600px;
    -webkit-perspective: 600px;
    z-index: -1;
}
@keyframes fly {
    from {
        transform: translateZ(-1200px); /* ØªØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø¹Ù…Ù‚ Ø§Ù„Ø¨Ø¹ÙŠØ¯ */
        opacity: 0;
    }
    10% {
        opacity: 1;
    }
    90% {
        opacity: 1;
    }
    to {
        transform: translateZ(600px); /* ØªÙ†ØªÙ‡ÙŠ Ø£Ù…Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ */
        opacity: 0;
    }
}
.star-field .layer {
    box-shadow: -411px -476px #cccccc, 777px -407px #d4d4d4, -387px -477px #fcfcfc, -91px -235px #d4d4d4, 491px -460px #f7f7f7, 892px -128px #f7f7f7, 758px -277px #ededed, 596px 378px #cccccc, 647px 423px whitesmoke, 183px 389px #c7c7c7,
        524px -237px #f0f0f0, 679px -535px #e3e3e3, 158px 399px #ededed, 157px 249px #ededed, 81px -450px #ebebeb, 719px -360px #c2c2c2, -499px 473px #e8e8e8, -158px -349px #d4d4d4, 870px -134px #cfcfcf, 446px 404px #c2c2c2,
        440px 490px #d4d4d4, 414px 507px #e6e6e6, -12px 246px #fcfcfc, -384px 369px #e3e3e3, 641px -413px #fcfcfc, 822px 516px #dbdbdb, 449px 132px #c2c2c2, 727px 146px #f7f7f7, -315px -488px #e6e6e6, 952px -70px #e3e3e3,
        -869px -29px #dbdbdb, 502px 80px #dedede, 764px 342px #e0e0e0, -150px -380px #dbdbdb, 654px -426px #e3e3e3, -325px -263px #c2c2c2, 755px -447px #c7c7c7, 729px -177px #c2c2c2, -682px -391px #e6e6e6, 554px -176px #ededed,
        -85px -428px #d9d9d9, 714px 55px #e8e8e8, 359px -285px #cfcfcf, -362px -508px #dedede, 468px -265px #fcfcfc, 74px -500px #c7c7c7, -514px 383px #dbdbdb, 730px -92px #cfcfcf, -112px 287px #c9c9c9, -853px 79px #d6d6d6,
        828px 475px #d6d6d6, -681px 13px #fafafa, -176px 209px #f0f0f0, 758px 457px #fafafa, -383px -454px #ededed, 813px 179px #d1d1d1, 608px 98px whitesmoke, -860px -65px #c4c4c4, -572px 272px #f7f7f7, 459px 533px #fcfcfc,
        624px -481px #e6e6e6, 790px 477px #dedede, 731px -403px #ededed, 70px -534px #cccccc, -23px 510px #cfcfcf, -652px -237px whitesmoke, -690px 367px #d1d1d1, 810px 536px #d1d1d1, 774px 293px #c9c9c9, -362px 97px #c2c2c2,
        563px 47px #dedede, 313px 475px #e0e0e0, 839px -491px #e3e3e3, -217px 377px #d4d4d4, -581px 239px #c2c2c2, -857px 72px #cccccc, -23px 340px #dedede, -837px 246px white, 170px -502px #cfcfcf, 822px -443px #e0e0e0, 795px 497px #e0e0e0,
        -814px -337px #cfcfcf, 206px -339px #f2f2f2, -779px 108px #e6e6e6, 808px 2px #d4d4d4, 665px 41px #d4d4d4, -564px 64px #cccccc, -380px 74px #cfcfcf, -369px -60px #f7f7f7, 47px -495px #e3e3e3, -383px 368px #f7f7f7, 419px 288px #d1d1d1,
        -598px -50px #c2c2c2, -833px 187px #c4c4c4, 378px 325px whitesmoke, -703px 375px #d6d6d6, 392px 520px #d9d9d9, -492px -60px #c4c4c4, 759px 288px #ebebeb, 98px -412px #c4c4c4, -911px -277px #c9c9c9;
  transform-style: preserve-3d;
position: absolute;
    top: 50%;
    left: 50%;
    height: 2px;
    width: 2px;
    border-radius: 50%;
    opacity: 0.1; /* ØªØ®ØªÙÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
    animation: fly 12s linear infinite;
}
        .star-field .layer:nth-child(1) { animation-delay: 0s; }
        .star-field .layer:nth-child(2) { animation-delay: -2s; }
        .star-field .layer:nth-child(3) { animation-delay: -4s; }
        .star-field .layer:nth-child(4) { animation-delay: -6s; }
        .star-field .layer:nth-child(5) { animation-delay: -8s; }
        .star-field .layer:nth-child(6) { animation-delay: -10s; }


        .audio-controls {
            position: fixed; top: 15px; left: 15px; z-index: 2000;
            background: rgba(255,255,255,0.1); padding: 10px; border-radius: 50%;
            cursor: pointer; border: 1px solid var(--neon-blue); width: 40px; height: 40px;
            display: flex; justify-content: center; align-items: center;
        }

        .stats-bar {
            display: flex; gap: 20px; margin: 15px 0; z-index: 10;
            background: rgba(255, 255, 255, 0.05); padding: 10px 25px; 
            border-radius: 50px; border: 1px solid var(--neon-blue);
        }

        .progress-container { width: 85%; max-width: 500px; height: 10px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 10px; overflow: hidden; }
        #progress-fill { width: 0%; height: 100%; background: var(--success); transition: 0.5s; }

        .solar-system {
            display: flex; flex-wrap: wrap; justify-content: center; gap: 12px;
            width: 95%; max-width: 900px; padding: 20px;
            background: rgba(255, 255, 255, 0.03); border-radius: 25px; border: 1px solid rgba(255,255,255,0.1);
        }

        .sun { width: 60px; height: 60px; background: radial-gradient(circle, #ffcc00, #ff4400); border-radius: 50%; box-shadow: 0 0 30px #ff6600; flex-shrink: 0; }
        
        /* Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø¥Ø³Ù‚Ø§Ø· */
        .drop-zone { width: 55px; height: 55px; border: 2px dashed rgba(255, 255, 255, 0.2); border-radius: 50%; transition: 0.3s; }
        .drop-zone.detecting { background: rgba(0, 212, 255, 0.2); border-color: var(--neon-blue); transform: scale(1.1); }
        .drop-zone.error { border-color: var(--error) !important; background: rgba(255, 51, 102, 0.2); animation: shake 0.4s ease-in-out; }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }

        .pool-container {
            margin-top: auto; margin-bottom: 100px; width: 95%; max-width: 850px;
            background: rgba(255, 255, 255, 0.07); border-radius: 20px; padding: 15px;
            display: flex; flex-wrap: wrap; justify-content: center; gap: 23px;
        }

        .planet-slot { width: 55px; height: 55px; background: rgba(0,0,0,0.3); border-radius: 50%; }

        .planet { 
            width: 55px; height: 55px; border-radius: 50%; position: absolute; 
            cursor: grab; z-index: 100; display: flex; justify-content: center; align-items: center;
        }
        
        .planet-img { 
            width: 100%; height: 100%; border-radius: 50%; background-size: contain !important; 
            background-repeat: no-repeat !important; background-position: center !important;
            animation: rotatePlanet 20s linear infinite;
        }
        @keyframes rotatePlanet { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        .planet span { position: absolute; bottom:-19px; font-size: 10px;font-weight:bold;border-radius:4px;pointer-events: none; }/*padding: 2px 6px;background: rgba(0,0,0,0.8);*/
        .planet.returning { transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
        .error-toast {
            position: absolute; top: -35px; background: var(--error); color: white;
            padding: 3px 10px; border-radius: 6px; font-size: 11px; white-space: nowrap;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4); z-index: 2000; pointer-events: none;
        }

        .modal-overlay {
            position: fixed; inset: 0; background: rgba(7,12,50,0.73);
            display: none; justify-content: center; align-items: center;
            z-index: 5000; backdrop-filter: blur(1px);
        }
        .modal-content {
            background: #030729; padding: 40px; border-radius: 30px; border: 1px solid var(--neon-blue);
            text-align: center; width: 85%; max-width: 380px; box-shadow: 0 0 20px 3px var(--neon-blue);
        }
        .rank-tag { color: var(--gold); font-size: 1.5rem; font-weight: bold; margin: 20px 0; display: block; }
        .retry-btn { background: var(--neon-blue); color: black;font-family: inherit; border: none; padding: 12px 40px; border-radius: 50px; font-weight: bold; cursor: pointer; }

        /* Welcome Screen Styles */
        #welcome-screen {
            position: fixed; inset: 0;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 7000;
            text-align: center;
            padding: 20px;
        }
        #astronaut-img {
            width: 180px; /* Ø­Ø¬Ù… Ø±Ø§Ø¦Ø¯ Ø§Ù„ÙØ¶Ø§Ø¡ */
            height: 180px;
            background-image: url('./assests/images/astronaut.webp'); /* Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø±Ø§Ø¦Ø¯ Ø§Ù„ÙØ¶Ø§Ø¡ */
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            animation: floatAstronaut 6s ease-in-out infinite; /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø³Ø¨Ø§Ø­Ø© */
            margin-bottom: 20px;
        }
        #astronaut-img img{
            height:100%;
        }
        @keyframes floatAstronaut {
            0% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-15px) rotate(7deg); }
            75% { transform: translateY(15px) rotate(-7deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }
        .welcome-text{
            font-size: 1.3rem;
            max-width: 600px;
            margin-bottom:0;
            line-height: 1.5;
        }
        h2.welcome-text{margin-bottom:50px;}
        #start-button {
            background: var(--neon-blue);
            font-family:'Noto Kufi Arabic';
            color: black;
            border: none;
            padding: 15px 50px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 0 15px var(--neon-blue);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        #start-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px var(--neon-blue);
        }
    </style>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@100..900&display=swap" rel="stylesheet">
</head>
<body>

<div id="welcome-screen">
    <div id="astronaut-img"></div>
    <h1 class="welcome-text">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ø³ØªÙƒØ´Ù!</h1>
    <h1 class="welcome-text">Ù„Ù‚Ø¯ Ø­Ø¯Ø« Ø§Ù†ÙØ¬Ø§Ø± Ø´Ù…Ø³ÙŠ Ø¹Ù†ÙŠÙ ÙˆØªØ¨Ø¹Ø«Ø±Øª Ø§Ù„ÙƒÙˆØ§ÙƒØ¨.</h1>
    <h2 class="welcome-text">Ø³Ø§Ø¹Ø¯Ù†ÙŠ ÙŠØ§ ØµØ¯ÙŠÙ‚ÙŠ ÙÙŠ Ø¥Ø¹Ø§Ø¯ØªÙ‡Ø§ Ù„Ù…Ø¯Ø§Ø±Ø§ØªÙ‡Ø§ Ø§Ù„ØµØ­ÙŠØ­Ø©!</h2>
    <button id="start-button">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ù‡Ù…Ø©!</button>
</div>

<div class="star-field">
    <div class="layer"></div><div class="layer"></div><div class="layer"></div>
    <div class="layer"></div><div class="layer"></div><div class="layer"></div>
</div>

<div class="audio-controls" onclick="toggleMusic()"><span id="mute-icon">ğŸ”‡</span></div>

<div id="game-content" style="display: none; width: 100%;flex-direction: column; align-items: center; min-height: 100vh;">
    <div class="stats-bar">
        <div class="stat-item">Ø§Ù„ØªÙ‚Ø¯Ù…: <span id="percent-text">0%</span></div>
        <div class="stat-item">Ø§Ù„Ø²Ù…Ù†: <span id="timer-text">0</span> Ø«</div>
    </div>

    <div class="progress-container"><div id="progress-fill"></div></div>

    <div class="solar-system">
        <div class="sun"></div>
        <div class="drop-zone" data-order="1"></div>
        <div class="drop-zone" data-order="2"></div>
        <div class="drop-zone" data-order="3"></div>
        <div class="drop-zone" data-order="4"></div>
        <div class="drop-zone" data-order="5"></div>
        <div class="drop-zone" data-order="6"></div>
        <div class="drop-zone" data-order="7"></div>
        <div class="drop-zone" data-order="8"></div>
    </div>

    <div class="pool-container" id="pool"></div>
</div>

<div class="modal-overlay" id="finish-modal">
    <div class="modal-content">
        <h2 style="color: var(--success)">Ù…Ù‡Ù…Ø© Ù†Ø§Ø¬Ø­Ø©! ğŸš€</h2>
        <p>Ø§Ù„Ø²Ù…Ù†: <span id="final-time">0</span> Ø«Ø§Ù†ÙŠØ©</p>
        <span class="rank-tag" id="final-rank"></span>
        <button class="retry-btn" onclick="location.reload()">Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
    </div>
</div>

<audio id="bg-music" loop src="./assests/audio/bg.mp3"></audio>
<audio id="snd-correct" src="./assests/audio/correct.mp3"></audio>
<audio id="snd-wrong" src="./assests/audio/wrong.mp3"></audio>

<script>
        const planetData = [
            { id: "1", name: "Ø¹Ø·Ø§Ø±Ø¯", img: "./assests/images/mercury.png" },
            { id: "2", name: "Ø§Ù„Ø²Ù‡Ø±Ø©", img: "./assests/images/venus.png" },
            { id: "3", name: "Ø§Ù„Ø£Ø±Ø¶", img: "./assests/images/earth.png" },
            { id: "4", name: "Ø§Ù„Ù…Ø±ÙŠØ®", img: "./assests/images/mars.png" },
            { id: "5", name: "Ø§Ù„Ù…Ø´ØªØ±ÙŠ", img: "./assests/images/jupiter.png" },
            { id: "6", name: "Ø²Ø­Ù„", img: "./assests/images/saturn.png" },
            { id: "7", name: "Ø£ÙˆØ±Ø§Ù†ÙˆØ³", img: "./assests/images/uranus.png" },
            { id: "8", name: "Ù†Ø¨ØªÙˆÙ†", img: "./assests/images/neptune.png" }
        ];
const lang={ best:"Ø±Ø§Ø¦Ø¯ ÙØ¶Ø§Ø¡ Ø£Ø³Ø·ÙˆØ±ÙŠ ğŸ–ï¸",
             good : "Ø®Ø¨ÙŠØ± ÙƒÙˆØ§ÙƒØ¨ğŸ‘¨â€ğŸš€",
             mid:"Ù…Ø³ØªÙƒØ´Ù ÙØ¶Ø§Ø¦ÙŠ ğŸš€",
             worst:"Ø±Ø§Ø¦Ø¯ ÙØ¶Ø§Ø¦ÙŠ Ù…Ø¨ØªØ¯Ø¦ ğŸ‘¨â€ğŸš€"};

    let correctCount = 0, seconds = 0, timerActive = false, timerInterval;
    const bgMusic = document.getElementById('bg-music');
    bgMusic.volume = 0.2;

    function playSfx(id) {
        const s = document.getElementById(id);
        if(s) { s.pause(); s.currentTime = 0; s.play().catch(()=>{}); }
    }

    function toggleMusic() {
        if (bgMusic.paused) { bgMusic.play(); document.getElementById('mute-icon').textContent = "ğŸ”Š"; }
        else { bgMusic.pause(); document.getElementById('mute-icon').textContent = "ğŸ”‡"; }
    }
/*
    function launchConfetti() {
        const canvas = document.createElement('canvas');
        canvas.style.position = 'fixed'; canvas.style.inset = 0; canvas.style.pointerEvents = 'none'; canvas.style.zIndex = '6000';
        document.body.appendChild(canvas);
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let p = Array.from({length: 120}, () => ({
            x: Math.random()*canvas.width, y: -20, s: Math.random()*5+2, 
            c: ['#00d4ff','#ffd700','#ff3366','#00ffcc'][Math.floor(Math.random()*4)],
            v: Math.random()*4+3
        }));
        function anim() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            p.forEach(i => { i.y += i.v; ctx.fillStyle = i.c; ctx.beginPath(); ctx.arc(i.x,i.y,i.s,0,6.28); ctx.fill(); });
            if(p[0].y < canvas.height + 50) requestAnimationFrame(anim); else canvas.remove();
        }
        anim();
    }*/
function launchConfetti() {
    const canvas = document.createElement('canvas');
    // ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù„ÙˆØ­Ø© Ù„ØªÙƒÙˆÙ† Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ© ÙÙˆÙ‚ ÙƒÙ„ Ø´ÙŠØ¡
    canvas.style.position = 'fixed'; 
    canvas.style.inset = 0; 
    canvas.style.pointerEvents = 'none'; 
    canvas.style.zIndex = '6000';
    document.body.appendChild(canvas);
    
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; 
    canvas.height = window.innerHeight;

    // Ù…ØµÙÙˆÙØ© Ø£Ù„ÙˆØ§Ù† "Ø³Ø¯ÙŠÙ…ÙŠØ©" (Nebula Colors)
    const nebulaColors = ['#6200ea', '#311b92', '#00d4ff', '#ff00ff', '#ffd700'];

    let p = Array.from({length: 150}, () => ({
        x: Math.random() * canvas.width, 
        y: -20, 
        s: Math.random() * 4 + 1, // Ø£Ø­Ø¬Ø§Ù… Ù…ØªÙØ§ÙˆØªØ© ÙƒØ§Ù„Ù†Ø¬ÙˆÙ…
        c: nebulaColors[Math.floor(Math.random() * nebulaColors.length)],
        v: Math.random() * 3 + 2, // Ø³Ø±Ø¹Ø© Ø§Ù„Ø³Ù‚ÙˆØ·
        glow: Math.random() * 10 + 5 // Ù‚ÙˆØ© Ø§Ù„ØªÙˆÙ‡Ø¬
    }));

    function anim() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        p.forEach(i => { 
            i.y += i.v; 
            
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± ØªÙˆÙ‡Ø¬ Ù„ÙƒÙ„ Ù†Ø¬Ù…Ø© Ø³Ø§Ù‚Ø·Ø©
            ctx.shadowBlur = i.glow;
            ctx.shadowColor = i.c;
            ctx.fillStyle = i.c;
            
            ctx.beginPath(); 
            ctx.arc(i.x, i.y, i.s, 0, 6.28); 
            ctx.fill(); 
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„ØªÙˆÙ‡Ø¬ Ø­ØªÙ‰ Ù„Ø§ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø®Ø±Ù‰
            ctx.shadowBlur = 0;
        });

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø£ÙˆÙ„ Ù†Ø¬Ù…Ø© Ø®Ø±Ø¬Øª Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ù„Ø­Ø°Ù
        if (p[0].y < canvas.height + 50) {
            requestAnimationFrame(anim); 
        } else {
            canvas.remove();
        }
    }
    anim();
}

    // ØªÙØ³ØªØ¯Ø¹Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ÙƒÙˆØ§ÙƒØ¨ ÙÙŠ Ø£Ù…Ø§ÙƒÙ†Ù‡Ø§ Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ø£Ùˆ Ø§Ù„Ù…Ø¹Ø§Ø¯ ØªÙ†Ø¸ÙŠÙ…Ù‡Ø§
    function repositionAll() {
        const planets = document.querySelectorAll('.planet');
        const slots = document.querySelectorAll('.planet-slot');
        if (slots.length === 0) return; // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù€ slots Ù‚Ø¯ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§
        
        planets.forEach((planet) => {
            if (planet.getAttribute('data-solved') !== 'true') {
                const index = Array.from(document.querySelectorAll('.planet-slot-id')).indexOf(document.getElementById('slot-'+planet.id));
                if (slots[index]) { // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù€ slot
                    const rect = slots[index].getBoundingClientRect();
                    planet.style.left = rect.left + 'px';
                    planet.style.top = rect.top + 'px';
                    planet.dataset.homeLeft = rect.left;
                    planet.dataset.homeTop = rect.top;
                }
            } else {
                const zone = document.querySelector(`.drop-zone[data-order="${planet.id}"]`);
                if (zone) { // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù€ zone
                    const zr = zone.getBoundingClientRect();
                    planet.style.left = (zr.left + (zr.width - 55)/2) + "px";
                    planet.style.top = (zr.top + (zr.height - 55)/2) + "px";
                }
            }
        });
    }

    // Ø³ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ repositionAll ÙÙ‚Ø· Ø¨Ø¹Ø¯ Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
    window.addEventListener('resize', () => { if(document.getElementById('game-content').style.display !== 'none') repositionAll(); });
    window.addEventListener('orientationchange', () => { if(document.getElementById('game-content').style.display !== 'none') setTimeout(repositionAll, 400); });

    // Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨Ø¯Ø¡
    document.getElementById('start-button').addEventListener('click', () => {
        document.getElementById('welcome-screen').style.display = 'none';
        document.getElementById('game-content').style.display = 'flex'; // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù„Ø¹Ø¨Ø©

        // Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØªØ±ØªÙŠØ¨Ù‡Ø§
        const pool = document.getElementById('pool');
        [...planetData].sort(() => Math.random() - 0.5).forEach((data) => {
            const slot = document.createElement('div');
            slot.className = 'planet-slot planet-slot-id';
            slot.id = 'slot-' + data.id;
            pool.appendChild(slot);

            const planet = document.createElement('div');
            planet.className = 'planet';
            planet.id = data.id;
            planet.innerHTML = `<div class="planet-img" style="background: url(${data.img})"></div><span>${data.name}</span>`;
            document.body.appendChild(planet);
            makeDraggable(planet);
        });

        // Ù†Ø¹Ø·ÙŠ Ø§Ù„Ù…ØªØµÙØ­ ÙˆÙ‚ØªØ§Ù‹ Ù„ØªØ±ØªÙŠØ¨ Ø¹Ù†Ø§ØµØ± DOM Ù‚Ø¨Ù„ Ø­Ø³Ø§Ø¨ Ø£Ù…Ø§ÙƒÙ† Ø§Ù„ÙƒÙˆØ§ÙƒØ¨
        setTimeout(repositionAll, 600);
    });


    function makeDraggable(el) {
        let p1=0, p2=0, p3=0, p4=0;
        const start = (e) => {
            if(el.getAttribute('data-solved') === 'true') return;
            if(!timerActive) {
                timerActive = true;
                bgMusic.play().then(() => document.getElementById('mute-icon').textContent = "ğŸ”Š").catch(()=>{});
                timerInterval = setInterval(() => { seconds++; document.getElementById('timer-text').textContent = seconds; }, 1000);
            }
            el.classList.remove('returning');
            const ev = e.touches ? e.touches[0] : e;
            p3 = ev.clientX; p4 = ev.clientY;
            document.onmousemove = move; document.ontouchmove = move;
            document.onmouseup = end; document.ontouchend = end;
            el.style.zIndex = 1000;
        };
        const move = (e) => {
            const ev = e.touches ? e.touches[0] : e;
            p1 = p3 - ev.clientX; p2 = p4 - ev.clientY;
            p3 = ev.clientX; p4 = ev.clientY;
            el.style.top = (el.offsetTop - p2) + "px";
            el.style.left = (el.offsetLeft - p1) + "px";
            const r = el.getBoundingClientRect();
            const cx = r.left + r.width/2, cy = r.top + r.height/2;
            document.querySelectorAll('.drop-zone').forEach(z => {
                const zr = z.getBoundingClientRect();
                if (cx > zr.left && cx < zr.right && cy > zr.top && cy < zr.bottom) z.classList.add('detecting');
                else z.classList.remove('detecting');
            });
        };
        const end = () => {
            document.onmousemove = document.ontouchmove = document.onmouseup = document.ontouchend = null;
            const r = el.getBoundingClientRect();
            const cx = r.left + r.width/2, cy = r.top + r.height/2;
            let zone = null;
            document.querySelectorAll('.drop-zone').forEach(z => {
                z.classList.remove('detecting');
                const zr = z.getBoundingClientRect();
                if (cx > zr.left && cx < zr.right && cy > zr.top && cy < zr.bottom) zone = z;
            });

            if (zone && el.id === zone.dataset.order) {
                el.setAttribute('data-solved', 'true');
                const zr = zone.getBoundingClientRect();
                el.style.left = (zr.left + (zr.width - 55)/2) + "px";
                el.style.top = (zr.top + (zr.height - 55)/2) + "px";
                el.onmousedown = el.ontouchstart = null;
                playSfx('snd-correct');
                correctCount++;
                document.getElementById('progress-fill').style.width = (correctCount/8)*100 + "%";
                document.getElementById('percent-text').textContent = Math.round((correctCount/8)*100) + "%";
                
                if (correctCount === 8) {
                    clearInterval(timerInterval);
                    launchConfetti();
                    document.getElementById('final-time').textContent = seconds;

                    document.getElementById('final-rank').textContent = 
                            seconds <= 30 ? lang.best :
                            seconds <= 50 ? lang.good :
                            seconds <= 70 ? lang.mid :
                            lang.worst;

                    setTimeout(() => document.getElementById('finish-modal').style.display = 'flex', 600);
                }
            } else {
                if(zone) {
                    playSfx('snd-wrong');
                    zone.classList.add('error');
                    setTimeout(() => zone.classList.remove('error'), 400);

                    const toast = document.createElement('div');
                    toast.className = 'error-toast';
                    toast.textContent = `Ù‡Ø°Ø§ Ù„ÙŠØ³ Ù…Ø¯Ø§Ø± ${el.querySelector('span').textContent}`;
                    el.appendChild(toast);
                    setTimeout(() => toast.remove(), 1000);
                }
                el.classList.add('returning');
                el.style.left = el.dataset.homeLeft + 'px';
                el.style.top = el.dataset.homeTop + 'px';
            }
        };
        el.onmousedown = start; el.ontouchstart = start;
    }
</script>
</body>
</html>